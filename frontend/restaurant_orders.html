<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Đơn Hàng Nhà Hàng</title>
  <link rel="stylesheet" href="cart.css">
</head>
<body>
  <div class="header">
    <div class="header-content">
      <h1>📋 Quản Lý Đơn Hàng</h1>
      <a href="home.html" class="back-btn">← Quay Lại</a>
    </div>
  </div>
  <div class="container">
    <div id="order-list"></div>
  </div>
<script>
function checkAuth() {
  const user = localStorage.getItem('user');
  if (!user) { window.location.href = 'index.html'; return; }
  currentUser = JSON.parse(user);

  if (currentUser.role !== "restaurant") {
    alert("Bạn không có quyền!");
    window.location.href="home.html";
  }
}

async function loadOrders() {
  const restaurantName = currentUser.username;  // tên user = tên nhà hàng
  const res = await fetch(`${API_BASE_URL}/orders/restaurant/${restaurantName}`);
  if (!res.ok) {
    console.error("API error", res.status);
    return;
  }
  const data = await res.json();
  if (data.success) {
    document.getElementById('order-list').innerHTML = data.orders.map(o => `
      <div class="cart-item">
        <div><b>Khách:</b> ${o.username}</div>
        <div><b>Mã đơn:</b> #${o.id}</div>
        <div><b>Tổng:</b> ${o.total_amount.toLocaleString('vi-VN')} VNĐ</div>
        <div><b>Trạng thái:</b> ${o.status}</div>
        <button class="checkout-btn" onclick="updateStatus(${o.id},'confirmed')">✅ Xác nhận</button>
        <button class="remove-btn" onclick="updateStatus(${o.id},'cancelled')">❌ Hủy</button>
      </div>
    `).join('');
  }
}

async function updateStatus(orderId, status) {
  await fetch(`${API_BASE_URL}/orders/${orderId}/status`, {
    method:"PUT",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({status})
  });
  loadOrders();
}

checkAuth();
loadOrders();
</script>
</body>
</html>
