<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>ÄÆ¡n HÃ ng NhÃ  HÃ ng</title>
  <link rel="stylesheet" href="cart.css">
</head>
<body>
  <div class="header">
    <div class="header-content">
      <h1>ğŸ“‹ Quáº£n LÃ½ ÄÆ¡n HÃ ng</h1>
      <a href="home.html" class="back-btn">â† Quay Láº¡i</a>
    </div>
  </div>
  <div class="container">
    <div id="order-list"></div>
  </div>
<script>
function checkAuth() {
  const user = localStorage.getItem('user');
  if (!user) { window.location.href = 'index.html'; return; }
  currentUser = JSON.parse(user);

  if (currentUser.role !== "restaurant") {
    alert("Báº¡n khÃ´ng cÃ³ quyá»n!");
    window.location.href="home.html";
  }
}

async function loadOrders() {
  const restaurantName = currentUser.username;  // tÃªn user = tÃªn nhÃ  hÃ ng
  const res = await fetch(`${API_BASE_URL}/orders/restaurant/${restaurantName}`);
  if (!res.ok) {
    console.error("API error", res.status);
    return;
  }
  const data = await res.json();
  if (data.success) {
    document.getElementById('order-list').innerHTML = data.orders.map(o => `
      <div class="cart-item">
        <div><b>KhÃ¡ch:</b> ${o.username}</div>
        <div><b>MÃ£ Ä‘Æ¡n:</b> #${o.id}</div>
        <div><b>Tá»•ng:</b> ${o.total_amount.toLocaleString('vi-VN')} VNÄ</div>
        <div><b>Tráº¡ng thÃ¡i:</b> ${o.status}</div>
        <button class="checkout-btn" onclick="updateStatus(${o.id},'confirmed')">âœ… XÃ¡c nháº­n</button>
        <button class="remove-btn" onclick="updateStatus(${o.id},'cancelled')">âŒ Há»§y</button>
      </div>
    `).join('');
  }
}

async function updateStatus(orderId, status) {
  await fetch(`${API_BASE_URL}/orders/${orderId}/status`, {
    method:"PUT",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({status})
  });
  loadOrders();
}

checkAuth();
loadOrders();
</script>
</body>
</html>
